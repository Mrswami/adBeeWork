<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>adBeeWork | Premium Schedule Sync</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="shortcut icon" href="https://img.icons8.com/color/48/bee.png" type="image/x-icon">
</head>

<body>
  <div id="app">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <span class="logo-icon">üêù</span>
        <span class="logo-text">adBeeWork</span>
      </div>

      <nav class="nav-menu">
        <div class="nav-item active" onclick="showSection('shifts')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <span class="nav-text">My Shifts</span>
        </div>
        <div class="nav-item" onclick="showSection('groupme')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
            </path>
          </svg>
          <span class="nav-text">GroupMe</span>
        </div>
        <div class="nav-item" onclick="showSection('settings')">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
            </path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
            </path>
          </svg>
          <span class="nav-text">Settings</span>
        </div>
      </nav>

      <div class="user-profile" id="user-profile-sidebar">
        <button class="btn btn-primary" id="btn-login-sidebar" onclick="loginWithGoogle()">Sign In</button>
        <div id="user-info-sidebar" class="hidden">
          <img id="user-avatar-sidebar" class="avatar" src="" alt="Avatar" />
          <div class="user-details">
            <div id="user-name-sidebar" style="font-weight:600; font-size: 0.875rem;"></div>
            <div id="user-email-sidebar" style="color:var(--text-muted); font-size: 0.75rem;"></div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Hero / Header -->
      <div style="display:flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2rem;">
        <div>
          <h1 id="main-title">My Work Shifts</h1>
          <p class="text-muted" id="main-subtitle">Manage your SocialSchedules and sync to Google Calendar.</p>
        </div>
        <div id="header-actions">
          <button class="btn btn-primary" onclick="saveAndFetch()" id="btn-sync-now">
            Sync Now
          </button>
        </div>
      </div>

      <!-- Shifts Section -->
      <section id="section-shifts" class="animate-in">
        <div class="schedules-grid" id="schedules-list">
          <!-- JS rendered cards -->
          <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
            <h2 style="margin-bottom: 1rem;">Welcome to adBeeWork</h2>
            <p class="text-muted" style="max-width: 500px; margin: 0 auto 2rem;">Connect your SocialSchedules iCal feed
              and your shifts will magically appear here, ready for Google Calendar sync.</p>
            <button class="btn btn-secondary" onclick="showSection('settings')">Configure iCal Feed</button>
          </div>
        </div>

        <div style="margin-top: 2rem; display: flex; justify-content: center;" id="sync-action-container"
          class="hidden">
          <button class="btn btn-primary" onclick="runSync()" style="padding: 1rem 3rem; font-size: 1.125rem;">
            Add Selected Shifts to Google Calendar
          </button>
        </div>
      </section>

      <!-- GroupMe Section -->
      <section id="section-groupme" class="animate-in hidden">
        <div class="card">
          <div class="groupme-panel" id="groupme-container">
            <div class="gm-sidebar" id="gm-groups">
              <div style="padding: 1.5rem; text-align: center; font-size: 0.875rem; color: var(--text-muted);">
                Load your Groups...
              </div>
            </div>
            <div class="gm-chat">
              <div id="gm-messages" class="gm-message-list">
                <div style="margin: auto; text-align:center; color: var(--text-muted);">
                  Select a group to view messages
                </div>
              </div>
              <div style="padding: 1rem; border-top: 1px solid var(--glass-border); display: flex; gap: 0.5rem;">
                <input type="text" id="gm-input" class="input-field" placeholder="Type a message...">
                <button class="btn btn-primary" id="btn-gm-send" onclick="sendGMMessage()">Send</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="section-settings" class="animate-in hidden">
        <div class="card">
          <h3>Configuration</h3>
          <div class="input-container">
            <label class="input-label">SocialSchedules iCal URL</label>
            <input type="url" id="ical-url" class="input-field" placeholder="https://app.socialschedules.com/ical/...">
            <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">SocialSchedules ‚Üí Menu ‚Üí Settings ‚Üí
              Calendar Sync ‚Üí Copy Link</p>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div class="input-container">
              <label class="input-label">Destination Google Calendar</label>
              <select id="cal-picker" class="input-field" disabled>
                <option value="">‚Äî Sign in to load calendars ‚Äî</option>
              </select>
            </div>
            <div class="input-container">
              <label class="input-label">Timezone</label>
              <select id="timezone" class="input-field">
                <option value="America/Chicago">Central Time (CT)</option>
                <option value="America/New_York">Eastern Time (ET)</option>
                <option value="America/Denver">Mountain Time (MT)</option>
                <option value="America/Los_Angeles">Pacific Time (PT)</option>
              </select>
            </div>
          </div>

          <div class="input-container">
            <label class="input-label">GroupMe Access Token</label>
            <input type="password" id="gm-token" class="input-field" placeholder="Paste your GroupMe dev token">
            <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">Get one at <a
                href="https://dev.groupme.com" target="_blank" style="color:var(--primary)">dev.groupme.com</a></p>
          </div>

          <button class="btn btn-primary" onclick="saveSettings()">Save Configuration</button>
          <button class="btn btn-secondary" onclick="logout()" style="margin-left: 1rem;">Sign Out</button>
        </div>

        <div class="card">
          <h3>Sync History</h3>
          <div id="history-list">
            <p class="text-muted">No sync history yet.</p>
          </div>
        </div>
      </section>

    </main>

    <!-- Modal Overlay (Generic) -->
    <div id="modal-overlay" class="hidden"
      style="position:fixed; inset:0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 2rem;">
      <div class="card" id="modal-content" style="max-width: 500px; width: 100%; margin: 0;">
        <!-- Content here -->
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">Message here</div>

    <!-- Loading Overlay -->
    <div id="loading" class="hidden"
      style="position:fixed; inset:0; background: rgba(15,23,42,0.9); z-index: 2000; display:flex; flex-direction:column; align-items:center; justify-content:center; gap: 1.5rem;">
      <div
        style="width: 50px; height: 50px; border: 4px solid var(--primary); border-top-color: transparent; border-radius:50%; animation: spin 1s linear infinite;">
      </div>
      <div id="loading-text" style="font-weight:500; color:var(--primary)">Loading shifts...</div>
    </div>

  </div>

  <style>
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .text-muted {
      color: var(--text-muted);
    }
  </style>

  <script src="app.js"></script>
</body>

</html>