# Project Handoff: adBeeWork Extension üêù

## Current State
The application has been transformed from a local dashboard into a **Unified Sidebar Extension**. 

- **Local Development**: Works 100%. The extension can communicate with `localhost:3000` to sync shifts and manage Google Calendar/GroupMe.
- **Cloud (Vercel)**: The backend is deployed at `https://ad-bee-work.vercel.app`. 
- **The Sidebar**: Uses a "dual-mode" `sidebar.html` that allows the user to switch between the Local and Cloud versions of the dashboard.

## Technical Architecture
- **Frontend**: Vanilla JS (PWA-enabled), CSS, HTML. Integrated into the extension sidebar via an iframe.
- **Backend**: Node.js/Express on Vercel. 
- **Persistence**: Switched from `express-session` to `cookie-session` specifically for Vercel's stateless nature. 
- **Authentication**: Google OAuth with specific scopes for email, profile, and calendar access.

## Known Blockers (The "Womp Womp" List)
1. **Sidebar Blankness (Cloud)**: Firefox's security frequently blocks the Vercel iframe in the sidebar. We've added aggressive CSP headers (`frame-ancestors *`) but browser-level security often overrides these if it's the first time connecting.
2. **Session Persistence (Cloud)**: Even with `cookie-session`, the login can be "forgotten" if the cookie size exceeds 4KB. We slimmed down the session data in `routes/auth.js`, but it needs further monitoring.
3. **Google OAuth (Cloud)**: Ensure `noless42@gmail.com` is added as a "Test User" in the Google Cloud Console "OAuth Consent" screen, or it will strike an "Invalid Client" error.

## Environment Variables (Vercel & Local)
Critical keys required in `.env` and Vercel:
- `GOOGLE_CLIENT_ID` / `GOOGLE_CLIENT_SECRET`
- `GOOGLE_REDIRECT_URI` (must match the active domain/callback)
- `SESSION_SECRET`
- `FIREBASE_SERVICE_ACCOUNT` (JSON string for Firestore access)

## Next Steps for the Next Agent
- **Verification**: Fix the "Invalid Client" mismatch between Vercel and Google Cloud.
- **Security**: Refine the CSP headers in `server.js` if Firefox continues to block the sidebar.
- **Permanent Upload**: Once the Cloud Sync is rock-solid, zip the `extension` folder and upload it to AMO (Firefox) and Chrome Web Store for permanent installation.

*Generated by Antigravity Handoff Protocol | 2026-02-21*
